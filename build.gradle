/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
def uname=System.getProperty("user.name")
def token ="b12e2f095cd2d7c5e95a70687cef6eb798206e936159dcf7"

task build(type: Exec) {
    workingDir "$projectDir"
    if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {
        executable 'cmd'
        args "/c", "docker build -t jupyter_r ."
    } else {
        executable "sh"
        args "-c", "docker build -t jupyter_r ."
    }
}

task start(type: Exec) {
    workingDir "$projectDir"
    if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {
        executable 'cmd'
        args "/c", "docker run --rm -d -p 8888:8888 -v ${projectDir}\notebooks:/home/${uname} -w=/home/${uname} -e NB_USER=${uname} -e JUPYTER_TOKEN=${token} --name jupyter_r --user root jupyter_r"
    } else {
        executable "sh"
        args "-c", "docker run --rm -d -p 8888:8888 -v ${projectDir}/notebooks:/home/${uname} -w=/home/${uname} -e NB_USER=${uname} -e JUPYTER_TOKEN=${token} --name jupyter_r --user root jupyter_r"
        executable "sh"
        args "-c", "open \"http://localhost:8888/tree?token=${token}\""
    }
}

task open(type:Exec) {
    sleep(2000)
    if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {
        executable 'cmd'
        args "/c", "open \"http://localhost:8888/tree?token=${token}\""
    } else {
        executable "sh"
        args "-c", "open \"http://localhost:8888/tree?token=${token}\""
    }
}

task run() {
    dependsOn(start, open)
}

task stop(type: Exec) {
    if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {
        executable 'cmd'
        args "/c", "docker container stop jupyter_r"
    } else {
        executable "sh"
        args "-c", "docker container stop jupyter_r"
    }
}